<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Book Appointment - South Fade</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Helvetica Neue',Arial,sans-serif;background:#000;color:#fff;min-height:100vh;padding:20px;line-height:1.6;}
.container{max-width:800px;margin:0 auto;background:#111;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.7);overflow:hidden;border:1px solid #333;}
.header{background:#000;color:#FFD700;padding:30px 20px;text-align:center;border-bottom:2px solid #FFD700;}
.header h1{font-size:2.2em;margin-bottom:8px;font-weight:800;letter-spacing:1px;}
.header p{font-size:1em;opacity:0.9;color:#ccc;}
.form-container{padding:30px;color:#eee;}
.form-group{margin-bottom:22px;}
label{display:block;margin-bottom:8px;color:#FFD700;font-weight:600;font-size:0.95em;text-transform:uppercase;letter-spacing:0.5px;}
label span{color:#ff4d4d;}
input,select,textarea{width:100%;padding:12px 15px;border:1px solid #333;border-radius:6px;font-size:1em;background:#1a1a1a;color:#fff;font-family:inherit;transition:all 0.3s ease;}
input:focus,select:focus,textarea:focus{outline:none;border-color:#FFD700;box-shadow:0 0 0 3px rgba(255,215,0,0.2);}
select{cursor:pointer;appearance:none;background:#1a1a1a url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23FFD700' viewBox='0 0 24 24'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e") no-repeat right 12px center;background-size:16px;}
.time-slots{display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:10px;margin-top:10px;}
.time-slot{padding:10px;border:1px solid #444;border-radius:6px;text-align:center;cursor:pointer;transition:all 0.2s;background:#222;color:#eee;font-weight:600;font-size:0.9em;}
.time-slot:hover:not(.disabled){border-color:#FFD700;background:#2a2a2a;transform:translateY(-1px);}
.time-slot.selected{background:#FFD700;color:#000;border-color:#FFD700;font-weight:bold;}
.time-slot.disabled{background:#1a1a1a;color:#555;cursor:not-allowed;opacity:0.6;text-decoration:line-through;}
.submit-btn{width:100%;padding:14px;background:linear-gradient(135deg,#FFD700,#D4AF37);color:#000;border:none;border-radius:6px;font-size:1.1em;font-weight:700;cursor:pointer;transition:all 0.3s;margin-top:10px;text-transform:uppercase;letter-spacing:1px;box-shadow:0 4px 10px rgba(0,0,0,0.3);}
.submit-btn:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 15px rgba(255,215,0,0.4);}
.submit-btn:disabled{background:#444;color:#777;cursor:not-allowed;transform:none;box-shadow:none;}
.loading{display:none;text-align:center;padding:20px;color:#FFD700;}
.loading.active{display:block;}
.spinner{border:3px solid rgba(255,215,0,0.2);border-top:3px solid #FFD700;border-radius:50%;width:30px;height:30px;animation:spin 1s linear infinite;margin:0 auto 10px;}
@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
.message{padding:12px 15px;border-radius:6px;margin:20px 0;display:none;font-weight:600;}
.message.active{display:block;}
.message.success{background:rgba(40,167,69,0.2);color:#56d678;border:1px solid #2b7a44;}
.message.error{background:rgba(220,53,69,0.2);color:#ff6b7f;border:1px solid #8a2a33;}
.info-box{background:rgba(255,215,0,0.05);border-left:3px solid #FFD700;padding:15px;border-radius:6px;margin-bottom:25px;color:#ddd;}
.info-box h3{color:#FFD700;margin-bottom:10px;font-size:1.1em;font-weight:600;}
.info-box li{margin:6px 0;color:#ccc;list-style-type:none;position:relative;}
.info-box li:before{content:"•";color:#FFD700;position:absolute;left:-15px;}
input[type="date"]{color-scheme:dark;}
@media(max-width:768px){.header h1{font-size:1.8em;}.form-container{padding:20px;}.time-slots{grid-template-columns:repeat(auto-fill,minmax(75px,1fr));}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1><i class="fas fa-cut"></i> South Fade Barbershop</h1>
    <p>Book Your Appointment Online</p>
  </div>

  <div class="form-container">
    <div class="info-box">
      <h3><i class="fas fa-clock"></i> Opening Hours</h3>
      <ul>
        <li><strong>Mon–Fri:</strong> 9:00 AM – 8:00 PM</li>
        <li><strong>Sat:</strong> 9:00 AM – 7:00 PM</li>
        <li><strong>Sun:</strong> 9:00 AM – 6:00 PM</li>
      </ul>
    </div>

    <div id="msg" class="message"></div>

    <form id="form">
      <div class="form-group">
        <label for="name">Full Name <span>*</span></label>
        <input type="text" id="name" required placeholder="Enter your full name">
      </div>

      <div class="form-group">
        <label for="email">Email Address <span>*</span></label>
        <input type="email" id="email" required placeholder="your@email.com">
      </div>

      <div class="form-group">
        <label for="phone">Phone Number <span>*</span></label>
        <input type="tel" id="phone" required placeholder="+44 7XXX XXXXXX">
      </div>

      <div class="form-group">
        <label for="service">Select Service <span>*</span></label>
        <select id="service" required><option value="">-- Choose a Service --</option></select>
      </div>

      <div class="form-group">
        <label for="date">Preferred Date <span>*</span></label>
        <input type="date" id="date" required>
      </div>

      <div class="form-group">
        <label>Available Time Slots <span>*</span></label>
        <div id="slots" class="time-slots"></div>
        <input type="hidden" id="time" required>
      </div>

      <div class="form-group">
        <label for="barber">Choose Barber <span>*</span></label>
        <select id="barber" required>
          <option value="">Select a Barber</option>
          <option value="Moh">Moh</option>
          <option value="Alex">Alex</option>
          <option value="Yass">Yass</option>
          <option value="Ali">Ali</option>
        </select>
      </div>

      <div class="form-group" style="display:none;">
        <textarea id="notes" rows="1"></textarea>
      </div>

      <button type="submit" class="submit-btn" id="btn">
        <i class="fas fa-calendar-check"></i> Book Appointment
      </button>
    </form>

    <div class="loading" id="load">
      <div class="spinner"></div>
      <p>Processing your booking...</p>
    </div>
  </div>
</div>

<script>
const URL='https://script.google.com/macros/s/AKfycbzhZNRIOPimun3NF-9ZTiSF7QHNISm1dczpIEHx6rg2eyElL7FKBLd1mxOHQ34exVM/exec';

const svcs=[
  {cat:'Classic/Fade',items:[{name:'Buzz cut Fade',price:24,dur:40},{name:'Wash & cut',price:25,dur:40},{name:'Skin Fade',price:27,dur:40}]},
  {cat:'Scissor Cut',items:[{name:'Basic Cut',price:27,dur:40}]},
  {cat:'Beard Trim',items:[{name:'Beard Trim clipper',price:17,dur:30},{name:'Beard trim Shape up & Towel',price:20,dur:30},{name:'Hot Towel Shave',price:25,dur:40}]},
  {cat:'Special Treatment',items:[{name:'Nose & Ear waxing',price:10,dur:20},{name:'Threading',price:10,dur:20},{name:'Facial',price:20,dur:30},{name:'Face mask',price:10,dur:30}]},
  {cat:'Kids Cut',items:[{name:'Kids Cut (Under 12)',price:20,dur:30},{name:'Student Cut (13-17)',price:23,dur:40}]},
  {cat:'O.A.P Haircut',items:[{name:'O.A.P Haircut',price:22,dur:40}]}
];

const barbers={Moh:[1,2],Alex:[0,1,2,3,4,5,6],Yass:[4,5,6],Ali:[5,6,0]};

const sel=document.getElementById('service'),
dateInp=document.getElementById('date'),
slotsDiv=document.getElementById('slots'),
timeInp=document.getElementById('time'),
frm=document.getElementById('form'),
btn=document.getElementById('btn'),
load=document.getElementById('load'),
msgDiv=document.getElementById('msg'),
barberSel=document.getElementById('barber'),
notes=document.getElementById('notes');

function init(){
  svcs.forEach(c=>{
    const og=document.createElement('optgroup');
    og.label=c.cat;
    c.items.forEach(s=>{
      const opt=document.createElement('option');
      opt.value=JSON.stringify(s);
      opt.textContent=`${s.name} - £${s.price}`;
      og.appendChild(opt);
    });
    sel.appendChild(og);
  });
  dateInp.min=new Date().toISOString().split('T')[0];
  dateInp.addEventListener('change',()=>{handleDateChange()});
  frm.addEventListener('submit',submit);
}

function handleDateChange(){
  if(!dateInp.value)return;
  const d=new Date(dateInp.value+'T00:00:00');
  const dow=d.getDay();
  filterBarbers(dow);
  loadSlots();
}

function filterBarbers(dow){
  for(const opt of barberSel.options)opt.disabled=false;
  for(let i=1;i<barberSel.options.length;i++){
    const val=barberSel.options[i].value;
    const avail=barbers[val]||[];
    barberSel.options[i].disabled=!avail.includes(dow);
  }
  const enabled=[...barberSel.options].filter(o=>!o.disabled&&o.value);
  barberSel.value=enabled.length===1?enabled[0].value:'';
}

function loadSlots(){
  if(!dateInp.value||!sel.value){
    slotsDiv.innerHTML='<p style="color:#999">Please select service and date</p>';
    return;
  }
  const d=new Date(dateInp.value+'T00:00:00');
  const dow=d.getDay();
  const svc=JSON.parse(sel.value);
  let open,close;
  if(dow>=1&&dow<=5){open=9;close=20}else if(dow===6){open=9;close=19}else{open=9;close=18;}
  const slots=genSlots(open,close,svc.dur);
  fetchBooked(dateInp.value).then(booked=>{
    slotsDiv.innerHTML='';
    slots.forEach(s=>{
      const div=document.createElement('div');
      div.className='time-slot';
      div.textContent=s;
      if(booked.includes(s)){div.classList.add('disabled');}
      else{div.onclick=()=>{document.querySelectorAll('.time-slot').forEach(x=>x.classList.remove('selected'));div.classList.add('selected');timeInp.value=s;}}
      slotsDiv.appendChild(div);
    });
  });
}

function genSlots(st,end,dur){
  const slots=[];
  for(let h=st;h<end;h++){
    for(let m=0;m<60;m+=dur){
      const eh=Math.floor((h*60+m+dur)/60);
      const em=(m+dur)%60;
      if(eh<end||(eh===end&&em===0)){
        slots.push(`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`);
      }
    }
  }
  return slots;
}

async function fetchBooked(dt){
  try{
    const res=await fetch(`${URL}?action=getBookings&date=${dt}`);
    const data=await res.json();
    return data.bookedSlots||[];
  }catch(e){console.error(e);return[];}
}

async function submit(e){
  e.preventDefault();
  if(!timeInp.value){showMsg('Please select a time slot','error');return;}
  if(!barberSel.value){showMsg('Please select a barber','error');return;}

  btn.disabled=true;
  load.classList.add('active');
  msgDiv.classList.remove('active');

  const svc=JSON.parse(sel.value);
  notes.value=`Barber: ${barberSel.value}`;
  const data={
    action:'createBooking',
    name:document.getElementById('name').value,
    email:document.getElementById('email').value,
    phone:document.getElementById('phone').value,
    service:svc.name,
    price:svc.price,
    date:dateInp.value,
    time:timeInp.value,
    notes:notes.value,
    timestamp:new Date().toISOString()
  };

  try{
    await fetch(URL,{method:'POST',mode:'no-cors',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});
    showMsg('Booking confirmed! Check your email.','success');
    frm.reset();
    slotsDiv.innerHTML='';
  }catch(e){
    console.error(e);
    showMsg('Booking submitted. Check your email.','success');
    frm.reset();
  }finally{
    btn.disabled=false;
    load.classList.remove('active');
  }
}

function showMsg(txt,type){
  msgDiv.textContent=txt;
  msgDiv.className=`message ${type} active`;
  setTimeout(()=>msgDiv.classList.remove('active'),5000);
}

init();
</script>
</body>
</html>
