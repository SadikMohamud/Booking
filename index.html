<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Book Appointment - South Fade</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Helvetica Neue',Arial,sans-serif;background:#000;color:#fff;min-height:100vh;padding:20px;}
.container{max-width:800px;margin:auto;background:#111;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.7);border:1px solid #333;}
.header{background:#000;color:#FFD700;padding:30px 20px;text-align:center;border-bottom:2px solid #FFD700;}
.header h1{font-size:2em;font-weight:800;}
.header p{font-size:0.95em;color:#bbb;}
.form-container{padding:30px;}
label{display:block;margin-bottom:8px;color:#FFD700;font-weight:600;}
input,select{width:100%;padding:12px 15px;border:1px solid #333;border-radius:6px;background:#1a1a1a;color:#fff;font-size:1em;}
input:focus,select:focus{outline:none;border-color:#FFD700;box-shadow:0 0 0 3px rgba(255,215,0,0.2);}
.time-slots{display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:10px;margin-top:10px;}
.time-slot{padding:10px;border:1px solid #444;border-radius:6px;text-align:center;cursor:pointer;background:#222;color:#eee;transition:all .2s;}
.time-slot:hover:not(.disabled){border-color:#FFD700;background:#2a2a2a;}
.time-slot.selected{background:#FFD700;color:#000;font-weight:bold;}
.time-slot.disabled{background:#1a1a1a;color:#555;cursor:not-allowed;opacity:0.6;text-decoration:line-through;}
.submit-btn{width:100%;padding:14px;background:linear-gradient(135deg,#FFD700,#D4AF37);color:#000;border:none;border-radius:6px;font-size:1.1em;font-weight:700;cursor:pointer;margin-top:20px;transition:all .2s;}
.submit-btn:hover:not(:disabled){opacity:0.9;}
.submit-btn:disabled{background:#444;color:#777;cursor:not-allowed;}
.message{padding:12px 15px;border-radius:6px;margin:20px 0;display:none;}
.message.active{display:block;}
.message.success{background:rgba(40,167,69,0.2);color:#56d678;border:1px solid #2b7a44;}
.message.error{background:rgba(220,53,69,0.2);color:#ff6b7f;border:1px solid #8a2a33;}
.loading{text-align:center;display:none;padding:10px;color:#FFD700;}
.loading.active{display:block;}
.spinner{border:3px solid rgba(255,215,0,0.2);border-top:3px solid #FFD700;border-radius:50%;width:30px;height:30px;animation:spin 1s linear infinite;margin:0 auto 10px;}
@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
option.disabled{color:#666;background:#222;}
@media(max-width:768px){.time-slots{grid-template-columns:repeat(auto-fill,minmax(75px,1fr));}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1><i class="fas fa-cut"></i> South Fade Barbershop</h1>
    <p>Book Your Appointment Online</p>
  </div>

  <div class="form-container">
    <div id="msg" class="message"></div>

    <form id="form">
      <label for="name">Full Name *</label>
      <input type="text" id="name" required placeholder="Enter your full name">

      <label for="email">Email *</label>
      <input type="email" id="email" required placeholder="your@email.com">

      <label for="phone">Phone *</label>
      <input type="tel" id="phone" required placeholder="+44 7XXX XXXXXX">

      <label for="service">Service *</label>
      <select id="service" required><option value="">-- Choose a Service --</option></select>

      <label for="date">Date *</label>
      <input type="date" id="date" required>

      <label for="barber">Barber *</label>
      <select id="barber" required>
        <option value="">Choose Master Barber</option>
        <option value="Moh">Moh</option>
        <option value="Alex">Alex</option>
        <option value="Yass">Yass</option>
        <option value="Ali">Ali</option>
      </select>

      <label>Time Slot *</label>
      <div id="slots" class="time-slots"></div>
      <input type="hidden" id="time" required>

      <button type="submit" class="submit-btn" id="btn"><i class="fas fa-calendar-check"></i> Book Appointment</button>
    </form>

    <div class="loading" id="load">
      <div class="spinner"></div>
      <p>Processing booking...</p>
    </div>
  </div>
</div>

<script>
/************************************************************
 * SOUTH FADE BOOKING SYSTEM (Front-End)
 * Fully compatible with Apps Script backend & dashboard
 ************************************************************/
const URL = 'https://script.google.com/macros/s/AKfycbzhZNRIOPimun3NF-9ZTiSF7QHNISm1dczpIEHx6rg2eyElL7FKBLd1mxOHQ34exVM/exec';

// Services
const svcs = [
  {cat:'Classic/Fade',items:[{name:'Buzz cut Fade',price:24,dur:40},{name:'Wash & cut',price:25,dur:40},{name:'Skin Fade',price:27,dur:40}]},
  {cat:'Scissor Cut',items:[{name:'Scissor Cut',price:27,dur:40},{name:'Restyle Cut',price:30,dur:40}]},
  {cat:'Beard Trim',items:[{name:'Beard Trim Clipper',price:17,dur:30},{name:'Beard Trim + Hot Towel',price:20,dur:30}]},
  {cat:'Special Treatment',items:[{name:'Facial',price:20,dur:30},{name:'Face Mask',price:10,dur:30}]}
];

// Barber working schedule (0=Sun)
const workingDays = {
  Moh: [1,2,3,4,5,6],
  Alex: [2,3,4,5,6],
  Yass: [0,3,4,5,6],
  Ali: [1,2,3,4,5],
};

// DOM elements
const sel=document.getElementById('service'),
dateInp=document.getElementById('date'),
slotsDiv=document.getElementById('slots'),
timeInp=document.getElementById('time'),
frm=document.getElementById('form'),
btn=document.getElementById('btn'),
load=document.getElementById('load'),
msgDiv=document.getElementById('msg'),
barberSel=document.getElementById('barber');

// INIT
function init(){
  // Populate services
  svcs.forEach(c=>{
    const og=document.createElement('optgroup');
    og.label=c.cat;
    c.items.forEach(s=>{
      const opt=document.createElement('option');
      opt.value=JSON.stringify(s);
      opt.textContent=`${s.name} - £${s.price}`;
      og.appendChild(opt);
    });
    sel.appendChild(og);
  });
  dateInp.min=new Date().toISOString().split('T')[0];
  dateInp.addEventListener('change',()=>{updateBarbers();loadSlots();});
  barberSel.addEventListener('change',loadSlots);
  sel.addEventListener('change',loadSlots);
  frm.addEventListener('submit',submit);
}

// Disable barbers not working that day
function updateBarbers(){
  const dateVal=dateInp.value;
  if(!dateVal)return;
  const day=new Date(dateVal).getDay();
  [...barberSel.options].forEach(opt=>{
    if(opt.value && workingDays[opt.value] && !workingDays[opt.value].includes(day)){
      opt.disabled=true;
      opt.classList.add('disabled');
    } else {
      opt.disabled=false;
      opt.classList.remove('disabled');
    }
  });
}

// Generate slots
function genSlots(open,close,dur){
  const slots=[];
  for(let h=open;h<close;h++){
    for(let m=0;m<60;m+=dur){
      slots.push(`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`);
    }
  }
  return slots;
}

// Fetch booked times
async function fetchBooked(date,barber){
  try{
    const res=await fetch(`${URL}?action=getBookings&date=${date}&barber=${encodeURIComponent(barber)}`);
    const data=await res.json();
    return data.bookedSlots||[];
  }catch(e){
    console.error('Error fetching booked slots:',e);
    return [];
  }
}

// Load time slots
async function loadSlots(){
  const svcVal=sel.value,dateVal=dateInp.value,barberVal=barberSel.value;
  if(!svcVal||!dateVal||!barberVal){
    slotsDiv.innerHTML='<p style="color:#999">Select service, date & barber.</p>';
    return;
  }
  const svc=JSON.parse(svcVal);
  const day=new Date(dateVal).getDay();
  const [open,close]=(day===0)?[9,17]:(day===6)?[9,19]:[9,20];
  const allSlots=genSlots(open,close,svc.dur);
  const booked=await fetchBooked(dateVal,barberVal);
  slotsDiv.innerHTML='';
  allSlots.forEach(slot=>{
    const div=document.createElement('div');
    div.className='time-slot';
    div.textContent=slot;
    if(booked.includes(slot)){
      div.classList.add('disabled');
    }else{
      div.onclick=()=>{
        document.querySelectorAll('.time-slot').forEach(s=>s.classList.remove('selected'));
        div.classList.add('selected');
        timeInp.value=slot;
      };
    }
    slotsDiv.appendChild(div);
  });
}

// Submit form
async function submit(e){
  e.preventDefault();
  if(!timeInp.value)return showMsg('Please select a time slot','error');
  const svc=JSON.parse(sel.value);
  const data={
    action:'createBooking',
    name:document.getElementById('name').value.trim(),
    email:document.getElementById('email').value.trim(),
    phone:document.getElementById('phone').value.trim(),
    service:svc.name,
    price:svc.price,
    date:dateInp.value,
    time:timeInp.value,
    barber:barberSel.value
  };
  btn.disabled=true;load.classList.add('active');msgDiv.classList.remove('active');
  try{
    const res=await fetch(URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});
    const result=await res.json();
    if(result.success){
      showMsg('✅ Booking confirmed!','success');
      frm.reset();
      slotsDiv.innerHTML='';
    }else{
      showMsg(result.error||'Booking failed.','error');
    }
  }catch(err){
    console.error(err);
    showMsg('Server error. Try again later.','error');
  }finally{
    btn.disabled=false;load.classList.remove('active');
  }
}

// Show message
function showMsg(text,type){
  msgDiv.textContent=text;
  msgDiv.className=`message ${type} active`;
  setTimeout(()=>msgDiv.classList.remove('active'),5000);
}

init();
</script>
</body>
</html>
